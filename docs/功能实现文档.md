# 函数类
特别的！本文中所有加粗的变量，都是为了传引用，为了得到函数的返回值设计的
每个函数完成后，可以**在开头的多选框标注已经完成**，方便知晓进度！！！！
用如下格式即可
- [x] 已完成
- [ ] 未完成 
## 主信息类型
- [ ] 需要创建一个物品信息struct
- [ ] 需要创建一个地点信息struct
- [ ] 需要创建一个申请添加信息struct

## 输入输出函数

### 时间戳生成，转换函数
+ 包名：`time_base64.csp`
- [x] get_local_timestamp()
    + 获取本地时间的base64时间戳
- [x] get_utc_timestamp()
    + 获取utc时间的base64时间戳
- [x] timestamp2string(stamo)
    + 将时间戳转换为读得懂的字符串。
- [x] from_timestamp(t)
    + 返回一个hash_map对象，按字段记录了时间信息hashmap的访问通过.first（字段） .second（值）进行
# 提交新物品信息
+ 包名`new_request.csp`
## csv输入输出函数
+ 包名：`csv.csp`
+ 完成人：赵文野
- [x] csv输入函数
  + 函数原型read_csv(path,**index**,**values**)
  + path是路径，index是一维数组，values是二位数组，分别对应每一条记录。
  + 功能: 输入csv文件的相对路径，然后将csv文件的第一行标题数据依次返回到index；数据值以二维数组组织到values中，其中的每个一维数组为“横着的”，即一条完整的记录作为一个一维数组，而非一列数组组织称一维数组。
- [x] csv输出函数
  + 函数原型write_csv(path,**index**,**values**)
  + 即上方函数的反函数。

## 数据库交互函数
- [ ] 查找创建地点信息的函数
  + 函数原型check_place(**loc**)
  + loc是地点信息struct，如果查找到该地点已经在地点表中存在，将该地点uuid赋值给loc中的uuid。
  + 如果不存在，则创建该地点的信息，并将新创建地点的uuid赋值给loc中的uuid。
- [ ] 向物品信息表中添加条目的函数
  + 函数原型add_pro(**item**)
  + item是物品信息struct，其中存放了物品信息
  + 添加完成后将该条目的uuid赋值给item中的uuid
- [ ] 向申请添加信息表中添加条目的函数
  + 函数原型add_req(info)
  + info是申请添加信息struct，其中存放了申请添加信息，包含要添加的物品在主表中的uuid(即申请添加信息表中的item_id)，状态置为待审核。
- [ ] 修改物品信息表中条目内容的函数
  + 函数原型change_pro(**item**)
  + item是物品信息struct，其中存放了物品信息
  + 根据uuid找到物品信息表中的条目并修改
- [ ] 修改申请添加信息表中条目的函数
  + 函数原型change_req(info)
  + info是申请添加信息struct，其中存放了申请添加信息，包含要添加或修改的物品在主表中的uuid(即申请添加信息表中的item_id)，状态置为待审核。
  + 根据item_id找到要修改的条目并修改
- [ ] 选取当前管理员所有被驳回条目的函数
  + 函数原型find_reject(id, **list**)
  + id是当前管理员的uuid
  + list是二维数组，包含查找到的所有条目。
  + select * from request_tb<br>
  where requester = id and signals = 2 ;

## 流程窗体
- [ ] 提交新物品信息界面
  + 函数原型new_request(**req_opened**)
  + 包含三个按钮，分别为单条录入、通过文件导入和返回。
  - [ ] 单条录入主界面
    + 函数原型single(**sin_opened**)
    + 包含输入文本框，提交按钮和完成按钮。
    + 点击完成按钮退回提交新物品信息界面。
    - [ ] 提交成功弹窗
      + 函数原型submit_succeed(**suc_opened**)
      + 包含一个显示提交成功的文本框
      + 弹出0.5s后自动关闭。
    - [ ] 提交失败弹窗 
      + 函数原型submit_fail(**fail_opened**)
      + 包含文本框和重新提交按钮，文本框显示错误信息。
      + 点击重新提交按钮后回到单条录入主界面，上一次输入的内容予以保留。
  - [ ] 文件导入主界面
    + 函数原型file_in(**file_opened**)
    + 包含填写路径的文本框，呼出windows资源管理器的按钮，提交按钮和返回按钮。
    + 点击返回按钮则返回提交新物品信息界面。
    + 点击提交后会弹出反馈窗口
    - [ ] 反馈弹窗
      + 函数原型feedback(**feed_opened**)
      + 包含反馈内容的文本框和确定按钮
      + 反馈内容可能包括：“正在提交，请稍后”，“提交成功”，“文件内容问题（格式错误、包含非法的字符等）”、“文件读取问题”、“与数据库通信出现问题”等。
      + 报错或成功后确定按钮才可点击，点击后返回文件导入主界面，上一次输入的内容予以保留。
- [ ] 修改被驳回申请界面
  + 函数原型fix_request(**fix_opened**)
  + 包含一个可滚动的文本框，逐条显示被驳回的的申请条目，每个条目后有一个处理按钮，底部有一个完成按钮。
  + 点击处理，弹出修改窗口。
  + 点击完成，返回小组管理员界面。
  - [ ] 修改窗口
    + 函数原型change(**ch_opened**)
    + 包含可修改的文本框，其中有要修改条目的全部可改写信息，一个提交按钮，一个取消按钮。
    + 点击提交按钮后如果提交成功则直接返回上一级界面，该条目的处理按钮变为不可点击，按钮文本变为“已处理”。
    + 点击提交按钮后如果失败则弹出修改失败弹窗。
    + 点击取消按钮直接返回上一级界面。
    - [ ] 修改失败弹窗
      + 函数原型ch_fail(**cf_opened**)
      + 包含一个显示错误信息的文本框，一个确认按钮。
      + 点击确认按钮返回修改窗口。
# 同级别移动物品

+ 包名：`Item_movement.csp`

- [ ] write_change_statement(id, to_place, )

  + id 是物品ID， to_place是去向
  + from_place/requester可以通过id查出
  + commiter可以通过to_place查出
  + req_time 通过get_local_timestamp()或get_utc_timestamp()完成
  + 写变动表,把内容填上去
- [ ] modify_state(id)
  + 修改状态，需要注意需要保存原有状态
  + 通过id改变signal
  + 记住先write_change_statement再modify_state（顺序很重要）

- [ ] delete_change_statement(id)

  + 移除变动表,就删数据表的内容
  + 通过id反查变动地点表，然后删除字段
  + 建议先add_log，再modify_item_list_information1或modify_item_list_information2，再delete_change_statement

- [ ] modify_item_list_information1(id)

  + 修改物品表信息,修改信息，改地址
  + 通过id反查
  + 恢复signal(signal)，改变地址(to_place)，即可
  + 建议先add_log，再modify_item_list_information1，再delete_change_statement

- [ ] add_log(id)

  + 添加日志,自动生成
  + 通过id查询变动地点表
  + 通过查询信息自动化生成string，并生成日志信息
  + signal是固定的，，
  + 建议先add_log，再modify_item_list_information1或modify_item_list_information2，再delete_change_statement
  + 这个可以分成两部分写，一个是同意，一个是驳回

- [ ] rejection_of_demand(id)

  + 驳回需求,删除变动表(复用)，恢复原来的记录
  + 建议先add_log，再modify_item_list_information2，再delete_change_statement
  + 这个把三个函数包起来
  + <font color=red>直接调用这个包即可</font>

- [ ] modify_item_list_information2(id)

  + 修改物品表信息,修改信息，改地址
  + 通过id反查
  + 恢复signal(signal)，地址(from_place)*其实可以不用修改*，即可
  + 建议先add_log，再modify_item_list_information2，再delete_change_statement

- [ ] acceptance_of_demand(id)

  + 建议先add_log，再modify_item_list_information1，再delete_change_statement
  + <font color=red>直接调用这个包即可</font>

- [ ] start_change(id, to_place, commiter)

  + 记住先write_change_statement再modify_state（顺序很重要）
  + <font color=red>直接调用这个包即可</font>
